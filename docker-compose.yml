# ===================================================================
# FINAL & CORRECTED docker-compose.yml for JalanSafe Project
# ADDED PERSISTENT STORAGE FOR UPLOADS
# ===================================================================
services:
  app:
    build: .
    container_name: sar_backend_app
    restart: unless-stopped
    volumes:
      # Mount GEE credentials
      - 'C:\Users\User\.config\earthengine:/root/.config/earthengine'
      # [FINAL FIX] Mount the local 'uploads' folder to the container's '/app/uploads' folder
      # This makes all uploaded photos persistent.
      - ./uploads:/app/uploads
    env_file:
      - .env
    extra_hosts:
      - "host.docker.internal:host-gateway"

  ngrok:
    image: ngrok/ngrok:latest
    container_name: sar_ngrok_tunnel
    restart: unless-stopped
    ports:
      - "4040:4040"
    depends_on:
      - app
    environment:
      - NGROK_AUTHTOKEN=${NGROK_AUTHTOKEN}
    command:
      - "http"
      - "app:8000"
      - "--domain=juliette-unattempted-tammara.ngrok-free.dev"
      - "--log=stdout"